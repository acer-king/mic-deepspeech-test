(this["webpackJsonpweb-microphone-websocket"]=this["webpackJsonpweb-microphone-websocket"]||[]).push([[0],{32:function(e,t,n){e.exports=n(64)},37:function(e,t,n){},61:function(e,t){},64:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),i=n(26),c=n.n(i),a=(n(37),n(27)),s=n(28),d=n(31),u=n(30),m=n(29),l=n.n(m),g=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(a.a)(this,n),(o=t.call(this,e)).startRecording=function(e){o.state.recording||(o.recordingInterval=setInterval((function(){var e=(new Date).getTime()-o.state.recordingStart;o.setState({recordingTime:e})}),100),o.setState({recording:!0,recordingStart:(new Date).getTime(),recordingTime:0},(function(){o.startMicrophone()})))},o.stopRecording=function(e){o.state.recording&&(o.state.connected&&o.socket.emit("stream-reset"),clearInterval(o.recordingInterval),o.setState({recording:!1},(function(){o.stopMicrophone()})))},o.state={connected:!1,recording:!1,recordingStart:0,recordingTime:0,recognitionOutput:[]},o}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=0;this.socket=new l.a("wss://www.deeplanguagesync.com/",{reconnectionDelayMax:1e4}),this.socket.on("connect",(function(){console.log("socket connected"),e.setState({connected:!0})})),this.socket.on("disconnect",(function(){console.log("socket disconnected"),e.setState({connected:!1}),e.stopRecording()})),this.socket.on("recognize",(function(n){console.log("recognized:",n);var o=e.state.recognitionOutput;n.id=t++,o.unshift(n),e.setState({recognitionOutput:o})}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",null,r.a.createElement("button",{disabled:!this.state.connected||this.state.recording,onClick:this.startRecording},"Start Recording"),r.a.createElement("button",{disabled:!this.state.recording,onClick:this.stopRecording},"Stop Recording"),this.renderTime()),this.renderRecognitionOutput())}},{key:"renderTime",value:function(){return r.a.createElement("span",null,(Math.round(this.state.recordingTime/100)/10).toFixed(1),"s")}},{key:"renderRecognitionOutput",value:function(){return r.a.createElement("ul",null,this.state.recognitionOutput.map((function(e){return r.a.createElement("li",{key:e.id},e.text)})))}},{key:"createAudioProcessor",value:function(e,t){var n=this,o=e.createScriptProcessor(4096,1,1),r=t.context.sampleRate,i=new Worker("./downsampling_worker.js");return i.postMessage({command:"init",inputSampleRate:r}),i.onmessage=function(e){n.state.connected&&n.socket.emit("stream-data",e.data.buffer)},o.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);i.postMessage({command:"process",inputFrame:t})},o.shutdown=function(){o.disconnect(),n.onaudioprocess=null},o.connect(e.destination),o}},{key:"startMicrophone",value:function(){var e=this;this.audioContext=new AudioContext;var t=function(t){console.log("started recording"),e.mediaStream=t,e.mediaStreamSource=e.audioContext.createMediaStreamSource(t),e.processor=e.createAudioProcessor(e.audioContext,e.mediaStreamSource),e.mediaStreamSource.connect(e.processor)},n=function(e){console.error("recording failure",e)};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(t).catch(n):navigator.getUserMedia({video:!1,audio:!0},t,n)}},{key:"stopMicrophone",value:function(){this.mediaStream&&this.mediaStream.getTracks()[0].stop(),this.mediaStreamSource&&this.mediaStreamSource.disconnect(),this.processor&&this.processor.shutdown(),this.audioContext&&this.audioContext.close()}}]),n}(o.Component);c.a.render(r.a.createElement(g,null),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.30a1d81d.chunk.js.map